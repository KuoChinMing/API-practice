const baseURL="http://ep.ebmtech.com:9006/";var AID="2f11d3bb-e65c-41b4-9f77-6a524aa50618";localStorage.setItem("AID",AID);AID=localStorage.getItem("AID");const token=localStorage.getItem("token"),authorizationToken=`Bearer ${token}`;let patientInfoAPI={},patientInfo={},admissionStatus={},nisTopRecords={};const report=new Map;function loadPatientInfo(){const t=`${baseURL}api/PatientInfoR?id=${AID}`;patientInfoAPI=$.ajax({url:t,dataType:"json",type:"GET",beforeSend(t){t.setRequestHeader("Authorization",authorizationToken)},success(t){patientInfo=t},error(t){console.log("request PatientInfo fail.")}})}function loadAdmissionStatus(){const t=`${baseURL}api/AdmissionStatus`;$.ajax({url:t,dataType:"json",type:"GET",beforeSend(t){t.setRequestHeader("Authorization",authorizationToken)},success(t){null!=(admissionStatus=findAdmissionStatus(t))&&loadNisTopRecord(admissionStatus.InHosDate)},error(t){console.log("request AdmissionStatus fail.")}})}function findAdmissionStatus(t){for(i=0;i<t.length;i++)if(t[i].AID==AID)return t[i];return null}function loadNisTopRecord(t){const e=`${baseURL}api/NISTPR?id=${AID}&startDate=${t}`;$.ajax({url:e,dataType:"json",type:"GET",beforeSend(t){t.setRequestHeader("Authorization",authorizationToken)},success(t){nisTopRecords=t},error(t){console.log("request NISTPR fail.")}})}function showPatientInfoTableHead(){$("#patient-info").append("<tr><th>病患姓名</th><th>身分證號</th><th>病例號</th><th>院所代號</th><th>出生日</th><th>性別</th><th>AID</th><th>開始日期</th><th>問題註記</th><th>重大傷病</th><th>過敏記錄</th><th>特殊註記</th><th>註記</th><th>檢驗名稱</th><th>數值</th><th>檢驗時間</th><th>報告</th></tr>")}function showPatientInfoTableData(){const t=generateInfo(),e=Object.keys(t);for($("#patient-info").append("<tr></tr>"),i=0;i<e.length;i++)$("#patient-info tr:last-child").append(`<td>${t[e[i]]}</td>`)}function generateInfo(){const t={};if(t.CNM=patientInfo.CNM,t.IDNO=patientInfo.IDNO,t.CHTNO=patientInfo.CHTNO,t.HOSID=patientInfo.HOSID,t.BRNDAT=patientInfo.HOSID,t.GENDER=0==patientInfo.Gender?"男":"女",t.AID=null!=admissionStatus?admissionStatus.AID:"無",t.InHosDate=null!=admissionStatus?admissionStatus.InHosDate:"無",t.ProblemNotes=null!=admissionStatus?interpretJsonString(admissionStatus.ProblemNotes):"無",t.CatastrophicIllness=null!=admissionStatus?interpretJsonString(admissionStatus.CatastrophicIllness):"無",t.Allergy=null!=admissionStatus?interpretJsonString(admissionStatus.Allergy):"無",t.SpecialNotes=null!=admissionStatus?interpretJsonString(admissionStatus.SpecialNotes):"無",t.Notes=null!=admissionStatus?interpretJsonString(admissionStatus.Notes):"無",t.Item="",jQuery.isEmptyObject(nisTopRecords))t.Item="無",t.Value="無",t.DateTime="無";else for(i=0;i<nisTopRecords.length;i++)t.Item+=`<div style="margin-top: 0.5rem; margin-bottom: 0.5rem;">${nisTopRecords[i].Item}</div>`,t.Value+=`<div style="margin-top: 0.5rem; margin-bottom: 0.5rem;">${nisTopRecords[i].Value}`,t.DateTime+=`<div style="margin-top: 0.5rem; margin-bottom: 0.5rem;">${nisTopRecords[i].DateTime}`;t.Report="";for(const e of report.keys())t.Report+=`<div style="white-space:nowrap; margin: 0.5rem 0 0.5rem 0;"><a class="report-link" href="#" tag="${report.get(e)}">${e}</a></div>`;return detectReportLinkClicked(),console.log(JSON.parse(admissionStatus.ProblemNotes)[0].LIST_TIME),console.log(t),t}function interpretJsonString(t){const e=JSON.parse(t);let n="";for(i=0;i<e.length;i++){const t=e[i],o=Object.keys(t);for(n+='<div style="margin-top: 1rem; margin-bottom: 1rem;">',j=0;j<o.length;j++)n+=`<span>${interpretKeyName(o[j])}</span>`+`<span>${t[o[j]]}</span>`+"<br>";n+="</div>"}return n}function interpretKeyName(t){switch(t){case"LIST_DATE":return"日期: ";case"LIST_TIME":return"時間: ";case"LIST_DOCTOR_NO":return"醫師編號: ";case"PROBLEM_DESC":return"問題描述: ";case"LIST_DIV_NO":return"區分編號: ";case"START_DATE":return"開始日期: ";case"END_DATE":return"結束日期: ";case"DISEASE_NAME":return"疾病名稱: ";case"CREATE_DATE":return"紀錄日期: ";case"CREATE_TIME":return"紀錄時間: ";case"ADVERSE_REACTION":return"不良反應: ";case"REC_CLERK":return"紀錄人員: ";case"REMARK_DESC":return"備註描述: ";default:return`${t}: `}}function createReportLink(t){t.set("查房首頁","Ad001"),t.set("住院病患資訊","Ad002"),t.set("住院診斷","Ad003"),t.set("檢驗報告","Ad004"),t.set("DDC報告","Ad005"),t.set("病理報告","Ad006"),t.set("檢查報告","Ad007"),t.set("生理報告","Ad008"),t.set("住院醫囑長期醫令","Ad009"),t.set("住院醫囑即時醫令","Ad010"),t.set("病歷摘要入院病摘","Ad011"),t.set("病歷摘要住院病摘","Ad012"),t.set("病歷摘要出院病摘","Ad013"),t.set("放射科報告","Ad014"),t.set("會診紀錄","Ad015"),t.set("歷史就醫紀錄","Ad016")}function detectReportLinkClicked(){$("#patient-info").on("click","a[class=report-link]",t=>{location.href=`report.html?AID=${AID}&tempCode=${$(t.target).attr("tag")}`})}createReportLink(report),loadPatientInfo(),loadAdmissionStatus(),$(document).ajaxStop(()=>{$("#loading-progress").hide(),showPatientInfoTableHead(),200==patientInfoAPI.status?showPatientInfoTableData():$("#patient-info").append('<tr><td colspan="11">尚無資料。</td><tr>')});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhdGllbnRJbmZvLmpzIl0sIm5hbWVzIjpbImJhc2VVUkwiLCJBSUQiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiZ2V0SXRlbSIsInRva2VuIiwiYXV0aG9yaXphdGlvblRva2VuIiwicGF0aWVudEluZm9BUEkiLCJwYXRpZW50SW5mbyIsImFkbWlzc2lvblN0YXR1cyIsIm5pc1RvcFJlY29yZHMiLCJyZXBvcnQiLCJNYXAiLCJsb2FkUGF0aWVudEluZm8iLCJjb21wbGF0ZWRVUkwiLCIkIiwiYWpheCIsInVybCIsImRhdGFUeXBlIiwidHlwZSIsIltvYmplY3QgT2JqZWN0XSIsInJlcXVlc3QiLCJzZXRSZXF1ZXN0SGVhZGVyIiwicmVzcG9uc2UiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwibG9hZEFkbWlzc2lvblN0YXR1cyIsInhociIsImZpbmRBZG1pc3Npb25TdGF0dXMiLCJsb2FkTmlzVG9wUmVjb3JkIiwiSW5Ib3NEYXRlIiwiYWxsQWRtaXNzaW9uU3RhdHVzIiwiaSIsImxlbmd0aCIsInNob3dQYXRpZW50SW5mb1RhYmxlSGVhZCIsImFwcGVuZCIsInNob3dQYXRpZW50SW5mb1RhYmxlRGF0YSIsImluZm8iLCJnZW5lcmF0ZUluZm8iLCJpbmZvS2V5cyIsIk9iamVjdCIsImtleXMiLCJDTk0iLCJJRE5PIiwiQ0hUTk8iLCJIT1NJRCIsIkJSTkRBVCIsIkdFTkRFUiIsIkdlbmRlciIsIlByb2JsZW1Ob3RlcyIsImludGVycHJldEpzb25TdHJpbmciLCJDYXRhc3Ryb3BoaWNJbGxuZXNzIiwiQWxsZXJneSIsIlNwZWNpYWxOb3RlcyIsIk5vdGVzIiwiSXRlbSIsImpRdWVyeSIsImlzRW1wdHlPYmplY3QiLCJWYWx1ZSIsIkRhdGVUaW1lIiwiUmVwb3J0IiwicmVwb3J0VGV4dCIsImdldCIsImRldGVjdFJlcG9ydExpbmtDbGlja2VkIiwiSlNPTiIsInBhcnNlIiwiTElTVF9USU1FIiwianNvblN0cmluZyIsImpzb25PYmplY3QiLCJyZXN1bHQiLCJzdWJPYmplY3QiLCJzdWJPYmplY3RLZXlzIiwiaiIsImludGVycHJldEtleU5hbWUiLCJrZXkiLCJjcmVhdGVSZXBvcnRMaW5rIiwic2V0Iiwib24iLCJlIiwibG9jYXRpb24iLCJocmVmIiwidGFyZ2V0IiwiYXR0ciIsImRvY3VtZW50IiwiYWpheFN0b3AiLCJoaWRlIiwic3RhdHVzIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxRQUFVLDhCQUVoQixJQUFJQyxJQUFNLHVDQUNWQyxhQUFhQyxRQUFRLE1BQU9GLEtBRXhCQSxJQUFNQyxhQUFhRSxRQUFRLE9BRS9CLE1BQU1DLE1BQVFILGFBQWFFLFFBQVEsU0FDN0JFLDZCQUErQkQsUUFDckMsSUFBSUUsZUFBaUIsR0FDakJDLFlBQWMsR0FDZEMsZ0JBQWtCLEdBQ2xCQyxjQUFnQixHQUNwQixNQUFNQyxPQUFTLElBQUlDLElBTW5CLFNBQVNDLGtCQUNQLE1BQU1DLEtBQWtCZCw4QkFBOEJDLE1BQ3RETSxlQUFpQlEsRUFBRUMsS0FBSyxDQUN0QkMsSUFBS0gsRUFDTEksU0FBVSxPQUNWQyxLQUFNLE1BQ05DLFdBQVdDLEdBQ1RBLEVBQVFDLGlCQUFpQixnQkFBaUJoQixxQkFFNUNjLFFBQVFHLEdBQ05mLFlBQWNlLEdBRWhCSCxNQUFNSSxHQUNKQyxRQUFRQyxJQUFJLGdDQUtsQixTQUFTQyxzQkFDUCxNQUFNYixLQUFrQmQsNkJBQ3hCZSxFQUFFQyxLQUFLLENBQ0xDLElBQUtILEVBQ0xJLFNBQVUsT0FDVkMsS0FBTSxNQUNOQyxXQUFXUSxHQUNUQSxFQUFJTixpQkFBaUIsZ0JBQWlCaEIscUJBRXhDYyxRQUFRRyxHQUVpQixPQUR2QmQsZ0JBQWtCb0Isb0JBQW9CTixLQUVwQ08saUJBQWlCckIsZ0JBQWdCc0IsWUFHckNYLE1BQU1JLEdBQ0pDLFFBQVFDLElBQUksb0NBS2xCLFNBQVNHLG9CQUFvQkcsR0FDM0IsSUFBS0MsRUFBSSxFQUFHQSxFQUFJRCxFQUFtQkUsT0FBUUQsSUFDekMsR0FBSUQsRUFBbUJDLEdBQUdoQyxLQUFPQSxJQUMv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QUFxQnVFLE9BQ3ZCbkQsMkJBRTBCLEtBQXpCNUIsZUFBZWdGLE9BQWlCbEQsMkJBQTZCdEIsRUFBRSxpQkFBaUJxQixPQUFPIiwiZmlsZSI6InBhdGllbnRJbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYmFzZVVSTCA9ICdodHRwOi8vZXAuZWJtdGVjaC5jb206OTAwNi8nO1xuXG52YXIgQUlEID0gJzJmMTFkM2JiLWU2NWMtNDFiNC05Zjc3LTZhNTI0YWE1MDYxOCc7XG5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnQUlEJywgQUlEKTsgLy8gc3RvcmUgZm9yZXJ2ZXJcblxudmFyIEFJRCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdBSUQnKTtcbi8vIHZhciBBSUQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwiQUlEXCIpO1xuY29uc3QgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndG9rZW4nKTtcbmNvbnN0IGF1dGhvcml6YXRpb25Ub2tlbiA9IGBCZWFyZXIgJHt0b2tlbn1gO1xubGV0IHBhdGllbnRJbmZvQVBJID0ge307XG5sZXQgcGF0aWVudEluZm8gPSB7fTtcbmxldCBhZG1pc3Npb25TdGF0dXMgPSB7fTtcbmxldCBuaXNUb3BSZWNvcmRzID0ge307XG5jb25zdCByZXBvcnQgPSBuZXcgTWFwKCk7XG5jcmVhdGVSZXBvcnRMaW5rKHJlcG9ydCk7XG5cbmxvYWRQYXRpZW50SW5mbygpO1xubG9hZEFkbWlzc2lvblN0YXR1cygpO1xuXG5mdW5jdGlvbiBsb2FkUGF0aWVudEluZm8oKSB7XG4gIGNvbnN0IGNvbXBsYXRlZFVSTCA9IGAke2Jhc2VVUkx9YXBpL1BhdGllbnRJbmZvUj9pZD0ke0FJRH1gO1xuICBwYXRpZW50SW5mb0FQSSA9ICQuYWpheCh7XG4gICAgdXJsOiBjb21wbGF0ZWRVUkwsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICB0eXBlOiAnR0VUJyxcbiAgICBiZWZvcmVTZW5kKHJlcXVlc3QpIHtcbiAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsIGF1dGhvcml6YXRpb25Ub2tlbik7XG4gICAgfSxcbiAgICBzdWNjZXNzKHJlc3BvbnNlKSB7XG4gICAgICBwYXRpZW50SW5mbyA9IHJlc3BvbnNlO1xuICAgIH0sXG4gICAgZXJyb3IoZXJyKSB7XG4gICAgICBjb25zb2xlLmxvZygncmVxdWVzdCBQYXRpZW50SW5mbyBmYWlsLicpO1xuICAgIH0sXG4gIH0pO1xufVxuXG5mdW5jdGlvbiBsb2FkQWRtaXNzaW9uU3RhdHVzKCkge1xuICBjb25zdCBjb21wbGF0ZWRVUkwgPSBgJHtiYXNlVVJMfWFwaS9BZG1pc3Npb25TdGF0dXNgO1xuICAkLmFqYXgoe1xuICAgIHVybDogY29tcGxhdGVkVVJMLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgdHlwZTogJ0dFVCcsXG4gICAgYmVmb3JlU2VuZCh4aHIpIHtcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBdXRob3JpemF0aW9uJywgYXV0aG9yaXphdGlvblRva2VuKTtcbiAgICB9LFxuICAgIHN1Y2Nlc3MocmVzcG9uc2UpIHtcbiAgICAgIGFkbWlzc2lvblN0YXR1cyA9IGZpbmRBZG1pc3Npb25TdGF0dXMocmVzcG9uc2UpOyAvLyBnZXQgdGhpcyBBSUQgYWRtaXNzaW9uU3RhdHVzXG4gICAgICBpZiAoYWRtaXNzaW9uU3RhdHVzICE9IG51bGwpIHtcbiAgICAgICAgbG9hZE5pc1RvcFJlY29yZChhZG1pc3Npb25TdGF0dXMuSW5Ib3NEYXRlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGVycm9yKGVycikge1xuICAgICAgY29uc29sZS5sb2coJ3JlcXVlc3QgQWRtaXNzaW9uU3RhdHVzIGZhaWwuJyk7XG4gICAgfSxcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGZpbmRBZG1pc3Npb25TdGF0dXMoYWxsQWRtaXNzaW9uU3RhdHVzKSB7XG4gIGZvciAoaSA9IDA7IGkgPCBhbGxBZG1pc3Npb25TdGF0dXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoYWxsQWRtaXNzaW9uU3RhdHVzW2ldLkFJRCA9PSBBSUQpIHtcbiAgICAgIHJldHVybiBhbGxBZG1pc3Npb25TdGF0dXNbaV07XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBsb2FkTmlzVG9wUmVjb3JkKEluSG9zRGF0ZSkge1xuICBjb25zdCBjb21wbGF0ZWRVUkwgPSBgJHtiYXNlVVJMfWFwaS9OSVNUUFI/aWQ9JHtBSUR9JnN0YXJ0RGF0ZT0ke0luSG9zRGF0ZX1gO1xuICAkLmFqYXgoe1xuICAgIHVybDogY29tcGxhdGVkVVJMLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgdHlwZTogJ0dFVCcsXG4gICAgYmVmb3JlU2VuZChyZXF1ZXN0KSB7XG4gICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0F1dGhvcml6YXRpb24nLCBhdXRob3JpemF0aW9uVG9rZW4pO1xuICAgIH0sXG4gICAgc3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgbmlzVG9wUmVjb3JkcyA9IHJlc3BvbnNlO1xuICAgIH0sXG4gICAgZXJyb3IoZXJyKSB7XG4gICAgICBjb25zb2xlLmxvZygncmVxdWVzdCBOSVNUUFIgZmFpbC4nKTtcbiAgICB9LFxuICB9KTtcbn1cblxuJChkb2N1bWVudCkuYWpheFN0b3AoKCkgPT4ge1xuICAkKCcjbG9hZGluZy1wcm9ncmVzcycpLmhpZGUoKTtcbiAgc2hvd1BhdGllbnRJbmZvVGFibGVIZWFkKCk7XG4gIC8vIEFJRCBjb3JyZXNwb25kaW5nIHBhdGllbnQgaW5mbyBjb3VsZCBub3QgYmUgZm91bmRcbiAgKHBhdGllbnRJbmZvQVBJLnN0YXR1cyA9PSAyMDApID8gc2hvd1BhdGllbnRJbmZvVGFibGVEYXRhKCkgOiAkKCcjcGF0aWVudC1pbmZvJykuYXBwZW5kKCc8dHI+PHRkIGNvbHNwYW49XCIxMVwiPuWwmueEoeizh+aWmeOAgjwvdGQ+PHRyPicpO1xufSk7XG5cbmZ1bmN0aW9uIHNob3dQYXRpZW50SW5mb1RhYmxlSGVhZCgpIHtcbiAgJCgnI3BhdGllbnQtaW5mbycpLmFwcGVuZChcbiAgICAnPHRyPidcbiAgICAgICAgKyAnPHRoPueXheaCo+Wnk+WQjTwvdGg+J1xuICAgICAgICArICc8dGg+6Lqr5YiG6K2J6JmfPC90aD4nXG4gICAgICAgICsgJzx0aD7nl4XkvovomZ88L3RoPidcbiAgICAgICAgKyAnPHRoPumZouaJgOS7o+iZnzwvdGg+J1xuICAgICAgICArICc8dGg+5Ye655Sf5pelPC90aD4nXG4gICAgICAgICsgJzx0aD7mgKfliKU8L3RoPidcbiAgICAgICAgLy8gZnJvbSBhZG1pc3Npb25TdGF0dXMgQVBJXG4gICAgICAgICsgJzx0aD5BSUQ8L3RoPidcbiAgICAgICAgKyAnPHRoPumWi+Wni+aXpeacnzwvdGg+J1xuICAgICAgICArICc8dGg+5ZWP6aGM6Ki76KiYPC90aD4nXG4gICAgICAgICsgJzx0aD7ph43lpKflgrfnl4U8L3RoPidcbiAgICAgICAgKyAnPHRoPumBjuaVj+iomOmMhDwvdGg+J1xuICAgICAgICArICc8dGg+54m55q6K6Ki76KiYPC90aD4nXG4gICAgICAgICsgJzx0aD7oqLvoqJg8L3RoPidcbiAgICAgICAgKyAnPHRoPuaqoumpl+WQjeeosTwvdGg+J1xuICAgICAgICArICc8dGg+5pW45YC8PC90aD4nXG4gICAgICAgICsgJzx0aD7mqqLpqZfmmYLplpM8L3RoPidcbiAgICAgICAgKyAnPHRoPuWgseWRijwvdGg+J1xuICAgICAgICArICc8L3RyPicsXG4gICk7XG59XG5cbmZ1bmN0aW9uIHNob3dQYXRpZW50SW5mb1RhYmxlRGF0YSgpIHtcbiAgY29uc3QgaW5mbyA9IGdlbmVyYXRlSW5mbygpO1xuICBjb25zdCBpbmZvS2V5cyA9IE9iamVjdC5rZXlzKGluZm8pO1xuICAkKCcjcGF0aWVudC1pbmZvJykuYXBwZW5kKCc8dHI+PC90cj4nKTtcbiAgZm9yIChpID0gMDsgaSA8IGluZm9LZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgJCgnI3BhdGllbnQtaW5mbyB0cjpsYXN0LWNoaWxkJykuYXBwZW5kKFxuICAgICAgYDx0ZD4ke2luZm9baW5mb0tleXNbaV1dfTwvdGQ+YCxcbiAgICApO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlSW5mbygpIHtcbiAgY29uc3QgaW5mbyA9IHt9O1xuXG4gIGluZm8uQ05NID0gcGF0aWVudEluZm8uQ05NO1xuICBpbmZvLklETk8gPSBwYXRpZW50SW5mby5JRE5PO1xuICBpbmZvLkNIVE5PID0gcGF0aWVudEluZm8uQ0hUTk87XG4gIGluZm8uSE9TSUQgPSBwYXRpZW50SW5mby5IT1NJRDtcbiAgaW5mby5CUk5EQVQgPSBwYXRpZW50SW5mby5IT1NJRDtcbiAgaW5mby5HRU5ERVIgPSAocGF0aWVudEluZm8uR2VuZGVyID09IDApID8gJ+eUtycgOiAn5aWzJztcblxuICBpbmZvLkFJRCA9IChhZG1pc3Npb25TdGF0dXMgIT0gbnVsbCkgPyBhZG1pc3Npb25TdGF0dXMuQUlEIDogJ+eEoSc7XG4gIGluZm8uSW5Ib3NEYXRlID0gKGFkbWlzc2lvblN0YXR1cyAhPSBudWxsKSA/IGFkbWlzc2lvblN0YXR1cy5Jbkhvc0RhdGUgOiAn54ShJztcbiAgaW5mby5Qcm9ibGVtTm90ZXMgPSAoYWRtaXNzaW9uU3RhdHVzICE9IG51bGwpID8gaW50ZXJwcmV0SnNvblN0cmluZyhhZG1pc3Npb25TdGF0dXMuUHJvYmxlbU5vdGVzKSA6ICfnhKEnO1xuICBpbmZvLkNhdGFzdHJvcGhpY0lsbG5lc3MgPSAoYWRtaXNzaW9uU3RhdHVzICE9IG51bGwpID8gaW50ZXJwcmV0SnNvblN0cmluZyhhZG1pc3Npb25TdGF0dXMuQ2F0YXN0cm9waGljSWxsbmVzcykgOiAn54ShJztcbiAgaW5mby5BbGxlcmd5ID0gKGFkbWlzc2lvblN0YXR1cyAhPSBudWxsKSA/IGludGVycHJldEpzb25TdHJpbmcoYWRtaXNzaW9uU3RhdHVzLkFsbGVyZ3kpIDogJ+eEoSc7XG4gIGluZm8uU3BlY2lhbE5vdGVzID0gKGFkbWlzc2lvblN0YXR1cyAhPSBudWxsKSA/IGludGVycHJldEpzb25TdHJpbmcoYWRtaXNzaW9uU3RhdHVzLlNwZWNpYWxOb3RlcykgOiAn54ShJztcbiAgaW5mby5Ob3RlcyA9IChhZG1pc3Npb25TdGF0dXMgIT0gbnVsbCkgPyBpbnRlcnByZXRKc29uU3RyaW5nKGFkbWlzc2lvblN0YXR1cy5Ob3RlcykgOiAn54ShJztcblxuICBpbmZvLkl0ZW0gPSAnJztcbiAgaWYgKCFqUXVlcnkuaXNFbXB0eU9iamVjdChuaXNUb3BSZWNvcmRzKSkge1xuICAgIGZvciAoaSA9IDA7IGkgPCBuaXNUb3BSZWNvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpbmZvLkl0ZW0gKz0gYDxkaXYgc3R5bGU9XCJtYXJnaW4tdG9wOiAwLjVyZW07IG1hcmdpbi1ib3R0b206IDAuNXJlbTtcIj4ke25pc1RvcFJlY29yZHNbaV0uSXRlbX08L2Rpdj5gO1xuICAgICAgaW5mby5WYWx1ZSArPSBgPGRpdiBzdHlsZT1cIm1hcmdpbi10b3A6IDAuNXJlbTsgbWFyZ2luLWJvdHRvbTogMC41cmVtO1wiPiR7bmlzVG9wUmVjb3Jkc1tpXS5WYWx1ZX1gO1xuICAgICAgaW5mby5EYXRlVGltZSArPSBgPGRpdiBzdHlsZT1cIm1hcmdpbi10b3A6IDAuNXJlbTsgbWFyZ2luLWJvdHRvbTogMC41cmVtO1wiPiR7bmlzVG9wUmVjb3Jkc1tpXS5EYXRlVGltZX1gO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpbmZvLkl0ZW0gPSAn54ShJztcbiAgICBpbmZvLlZhbHVlID0gJ+eEoSc7XG4gICAgaW5mby5EYXRlVGltZSA9ICfnhKEnO1xuICB9XG5cbiAgaW5mby5SZXBvcnQgPSAnJztcblxuICBmb3IgKGNvbnN0IHJlcG9ydFRleHQgb2YgcmVwb3J0LmtleXMoKSkge1xuICAgIGluZm8uUmVwb3J0ICs9IGA8ZGl2IHN0eWxlPVwid2hpdGUtc3BhY2U6bm93cmFwOyBtYXJnaW46IDAuNXJlbSAwIDAuNXJlbSAwO1wiPjxhIGNsYXNzPVwicmVwb3J0LWxpbmtcIiBocmVmPVwiI1wiIHRhZz1cIiR7cmVwb3J0LmdldChyZXBvcnRUZXh0KX1cIj4ke3JlcG9ydFRleHR9PC9hPjwvZGl2PmA7XG4gIH1cbiAgZGV0ZWN0UmVwb3J0TGlua0NsaWNrZWQoKTtcbiAgY29uc29sZS5sb2coSlNPTi5wYXJzZShhZG1pc3Npb25TdGF0dXMuUHJvYmxlbU5vdGVzKVswXS5MSVNUX1RJTUUpO1xuICBjb25zb2xlLmxvZyhpbmZvKTtcbiAgcmV0dXJuIGluZm87XG59XG5cbmZ1bmN0aW9uIGludGVycHJldEpzb25TdHJpbmcoanNvblN0cmluZykge1xuICBjb25zdCBqc29uT2JqZWN0ID0gSlNPTi5wYXJzZShqc29uU3RyaW5nKTtcbiAgbGV0IHJlc3VsdCA9ICcnO1xuICBmb3IgKGkgPSAwOyBpIDwganNvbk9iamVjdC5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHN1Yk9iamVjdCA9IGpzb25PYmplY3RbaV07XG4gICAgY29uc3Qgc3ViT2JqZWN0S2V5cyA9IE9iamVjdC5rZXlzKHN1Yk9iamVjdCk7XG4gICAgcmVzdWx0ICs9ICc8ZGl2IHN0eWxlPVwibWFyZ2luLXRvcDogMXJlbTsgbWFyZ2luLWJvdHRvbTogMXJlbTtcIj4nO1xuICAgIGZvciAoaiA9IDA7IGogPCBzdWJPYmplY3RLZXlzLmxlbmd0aDsgaisrKSB7XG4gICAgICByZXN1bHQgKz0gYDxzcGFuPiR7aW50ZXJwcmV0S2V5TmFtZShzdWJPYmplY3RLZXlzW2pdKX08L3NwYW4+YFxuICAgICAgICAgICAgICAgICsgYDxzcGFuPiR7c3ViT2JqZWN0W3N1Yk9iamVjdEtleXNbal1dfTwvc3Bhbj5gXG4gICAgICAgICAgICAgICAgKyAnPGJyPic7XG4gICAgfVxuICAgIHJlc3VsdCArPSAnPC9kaXY+JztcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBpbnRlcnByZXRLZXlOYW1lKGtleSkge1xuICBzd2l0Y2ggKGtleSkge1xuICAgIGNhc2UgJ0xJU1RfREFURSc6XG4gICAgICByZXR1cm4gJ+aXpeacnzogJztcbiAgICBjYXNlICdMSVNUX1RJTUUnOlxuICAgICAgcmV0dXJuICfmmYLplpM6ICc7XG4gICAgY2FzZSAnTElTVF9ET0NUT1JfTk8nOlxuICAgICAgcmV0dXJuICfphqvluKvnt6jomZ86ICc7XG4gICAgY2FzZSAnUFJPQkxFTV9ERVNDJzpcbiAgICAgIHJldHVybiAn5ZWP6aGM5o+P6L+wOiAnO1xuICAgIGNhc2UgJ0xJU1RfRElWX05PJzpcbiAgICAgIHJldHVybiAn5Y2A5YiG57eo6JmfOiAnO1xuICAgIGNhc2UgJ1NUQVJUX0RBVEUnOlxuICAgICAgcmV0dXJuICfplovlp4vml6XmnJ86ICc7XG4gICAgY2FzZSAnRU5EX0RBVEUnOlxuICAgICAgcmV0dXJuICfntZDmnZ/ml6XmnJ86ICc7XG4gICAgY2FzZSAnRElTRUFTRV9OQU1FJzpcbiAgICAgIHJldHVybiAn55a+55eF5ZCN56ixOiAnO1xuICAgIGNhc2UgJ0NSRUFURV9EQVRFJzpcbiAgICAgIHJldHVybiAn57SA6YyE5pel5pyfOiAnO1xuICAgIGNhc2UgJ0NSRUFURV9USU1FJzpcbiAgICAgIHJldHVybiAn57SA6YyE5pmC6ZaTOiAnO1xuICAgIGNhc2UgJ0FEVkVSU0VfUkVBQ1RJT04nOlxuICAgICAgcmV0dXJuICfkuI3oia/lj43mh4k6ICc7XG4gICAgY2FzZSAnUkVDX0NMRVJLJzpcbiAgICAgIHJldHVybiAn57SA6YyE5Lq65ZOhOiAnO1xuICAgIGNhc2UgJ1JFTUFSS19ERVNDJzpcbiAgICAgIHJldHVybiAn5YKZ6Ki75o+P6L+wOiAnO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gYCR7a2V5fTogYDtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVSZXBvcnRMaW5rKHJlcG9ydCkge1xuICByZXBvcnQuc2V0KCfmn6XmiL/pppbpoIEnLCAnQWQwMDEnKTtcbiAgcmVwb3J0LnNldCgn5L2P6Zmi55eF5oKj6LOH6KiKJywgJ0FkMDAyJyk7XG4gIHJlcG9ydC5zZXQoJ+S9j+mZouiouuaWtycsICdBZDAwMycpO1xuICByZXBvcnQuc2V0KCfmqqLpqZfloLHlkYonLCAnQWQwMDQnKTtcbiAgcmVwb3J0LnNldCgnRERD5aCx5ZGKJywgJ0FkMDA1Jyk7XG4gIHJlcG9ydC5zZXQoJ+eXheeQhuWgseWRiicsICdBZDAwNicpO1xuICByZXBvcnQuc2V0KCfmqqLmn6XloLHlkYonLCAnQWQwMDcnKTtcbiAgcmVwb3J0LnNldCgn55Sf55CG5aCx5ZGKJywgJ0FkMDA4Jyk7XG4gIHJlcG9ydC5zZXQoJ+S9j+mZoumGq+WbkemVt+acn+mGq+S7pCcsICdBZDAwOScpO1xuICByZXBvcnQuc2V0KCfkvY/pmaLphqvlm5HljbPmmYLphqvku6QnLCAnQWQwMTAnKTtcbiAgcmVwb3J0LnNldCgn55eF5q235pGY6KaB5YWl6Zmi55eF5pGYJywgJ0FkMDExJyk7XG4gIHJlcG9ydC5zZXQoJ+eXheatt+aRmOimgeS9j+mZoueXheaRmCcsICdBZDAxMicpO1xuICByZXBvcnQuc2V0KCfnl4XmrbfmkZjopoHlh7rpmaLnl4XmkZgnLCAnQWQwMTMnKTtcbiAgcmVwb3J0LnNldCgn5pS+5bCE56eR5aCx5ZGKJywgJ0FkMDE0Jyk7XG4gIHJlcG9ydC5zZXQoJ+acg+iouue0gOmMhCcsICdBZDAxNScpO1xuICByZXBvcnQuc2V0KCfmrbflj7LlsLHphqvntIDpjIQnLCAnQWQwMTYnKTtcbn1cblxuXG5mdW5jdGlvbiBkZXRlY3RSZXBvcnRMaW5rQ2xpY2tlZCgpIHtcbiAgJCgnI3BhdGllbnQtaW5mbycpLm9uKCdjbGljaycsICdhW2NsYXNzPXJlcG9ydC1saW5rXScsIChlKSA9PiB7XG4gICAgLy8gYWxlcnQoJChlLnRhcmdldCkuYXR0cigndGFnJykpO1xuICAgIGxvY2F0aW9uLmhyZWYgPSBgcmVwb3J0Lmh0bWw/QUlEPSR7QUlEfSZ0ZW1wQ29kZT0keyQoZS50YXJnZXQpLmF0dHIoJ3RhZycpfWA7XG4gIH0pO1xufVxuIl19
